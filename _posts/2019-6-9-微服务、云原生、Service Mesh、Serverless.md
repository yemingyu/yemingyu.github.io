---
layout:     post
title:      "微服务、云原生、Service Mesh、ServerLess"
subtitle:   "微服务、云原生、Service Mesh、ServerLess"
date:       2019-6-8
author:     "大禹"
header-img: "img/in-post/1004/usephone.jpg"
description: ""
category: 微服务 云原生 Service Mesh ServerLess
header-mask: 0.3
catalog:    true
tags:
    - 微服务

---

> 对于微服务、云原生、Service Mesh、ServerLess 这几个名词一直都有点混淆，此处做个简单的区分介绍。

## 微服务

### 什么是微服务？

参见维基百科的定义：微服务是由单一应用程序构成的小服务，拥有自己的进程和轻量化处理，服务依业务功能设计，以全自动的方式部署，与其他服务采用 HTTP API 通信。同时，服务会使用最小规模的集中管理（如 Docker）技术，服务可以用不同的编程语言和数据库。

### 为什么会有微服务？

一般项目从小到大，往往会经历**单体应用**、**SOA**，然后才是视需求引入**微服务**。无论是 LAMP（PHP 架构）还是 SSM（Java 架构）都是为单体应用架构设计的，简言之，单项目单工程，在项目规模和团队规模不大时，开发和维护成本都比较低，且具备上手快、开发迅速、部署测试方便等诸多好处。但随着业务和团队的发展，代码的不断增多，开发人员的不断增多，维护这样的大型单体应用成本会迅速升高，单体应用的变大会带来部署时间变长、发布变慢的问题，团队的扩大会带来多人开发分支与提交混乱问题，并且单体应用由于是单进程，某一小部分出问题如果造成进程出问题会影响整体的稳定性，高可用无从谈起。

所以为了解决上面大型单体应用的问题，通常采用**服务化拆分**的方式改造成**SOA**，简言之，将单体应用改造成分层架构，抽离出通用部分为一个个服务，然后通过 RPC 远程方式（如 Dubbo）调用服务接口，而非之前通过进程内函数调用。如单体应用做成 Web 层、Service 层、DAO 层、数据库层后，将 Service 层的一个个服务按需求抽离成单独工程，数据相关服务也可抽离，部署时 Web 层需要的服务都可以通过 RPC 框架来访问。

到这一步时，大部分团队其实以及可以正常开发和维护系统。前两步和移动端单工程到组件化架构的发展路径是类似的。

微服务的兴起得益于 **Docker** 等容器化技术的成熟，相对于**SOA**而言，提出了更高要求，更像是一种规范和准则：

* 服务拆分粒度更细，对于一个模块只要独立就可拆分成一个微服务，对于模块化拆分在权衡成本的情况下拆的尽量细。
* 服务独立部署，每个微服务都是独立打包部署，如通过 Docker 构建出服务实例，多个实例之间互不干扰，当某个实例挂掉后不影响其他实例。
* 服务独立维护，每个微服务都由独立团队或个人维护，开发、测试、部署、发布、运维全生命周期的管理。
* 服务治理能力要求高，随着服务拆分的细粒度提高，服务越来越多，需要有统一的管理平台进行管理。

这样就解决了单体应用的部署、维护、稳定性等问题。

### 选择微服务的时机与带来的新问题

选择微服务架构一定要慎重，因为任何一种架构都不是万能的，架构一定是用来解决实际问题的，不能为了用而用。

当团队人数较少时、单体项目不大时不要使用微服务架构，这个时候使用反而会使得维护成本不仅降低反而升高，只有业务和团队不断扩大到一定程度时才应该考虑。如项目的早期往往是为了快速验证，这个时候使用单体应用开发效率高、维护成本低。

服务的拆分方式和工程架构分层类似，都有**水平拆分**和**垂直拆分**，这里就不做深入。

那么带来的新的代价是什么？首先是**定义接口**，将服务进行封装如 RPC 接口，提供外部调用；原有的调用服务为进程内调用，当变成微服务架构时，就需要一个统一的**注册中心**（如 ZooKeeper），用来提供服务注册和订阅；**服务监控**；**问题诊断**；**服务治理**。

并且微服务架构，会带来测试、发布管理、分布式问题等各方面问题，No 银弹，所以选择好最合适的。

## 云原生

什么是云原生？参见 CNCF 的定义，云原生技术有利于各组织在公有云、私有云和混合云等新型动态环境中，构建和运行可弹性扩展的应用。

云原生应用要求：

* DevOps，开发与运维一同效力于交付高品质的软件服务于客户。

* 持续交付，软件的构建、测试和发布，要更快、更频繁、更稳定。频繁发布、快速交付、频繁反馈、降低发布风险。

* 微服务，以一组小型服务的形式来部署应用。应用间通过 RESTFUL API 通信，每个服务都可以被独立的部署、更新、扩容、重启，可参见 Spring Cloud 微服务开发框架。

* 容器，提供比传统虚拟机更高的效率。容器化，Docker + Kubernetes 可作为目前最好的载体。

可以看出一个云原生应用相对于本地部署应用而言结构更为复杂，要求也更高。

## Service Mesh / 服务网格

什么是 Service Mesh？Service Mesh 是一个**基础设施层**，用于处理服务间通信。云原生应用有着复杂的服务拓扑，Service Mesh 负责在这些拓扑中**实现请求的可靠传递**。在实践中，Service Mesh 通常实现为一组**轻量级网络代理**，它们与应用程序部署在一起，而**对应用程序透明**。

本质上是将应用中和服务调用相关的部分抽出来成为一个单独的服务，这个服务接受应用的调用，并完成完整的服务调用流程，如服务发现负载均衡，最后将请求发送给目标系统。那么系统中所有的这种服务抽离出来后，互相之间就会有网格状的调用关系，这一层也就抽象成了服务之间的通信层。

目前主流的 Service Mesh 解决方案为 Google 的 **istio**，在没有 Service Mesh 之前，本身用 Spring Cloud 也可以简化微服务对服务调用的处理（包括服务注册、服务发现、负载均衡、熔断 / 重试等，这也是微服务带来的新的复杂问题），**istio** 本质上是将服务调用这一层从微服务中抽出来作为独立进程，无论是熟悉 Spring Cloud 还是 istio 都是具有一定成本的。

## ServerLess

Serverless 字面的意思就是说‘无服务器’，不用关心服务器怎么来的，不用关心基础设施，只要关心业务代码就可以了。

开发者在开发应用时，对于需要的后端服务直接调用，不关心服务器和基础设施的存在，理论上可做到真正意义上的全栈。

目前微信小程序里已经用起来了，提供函数计算、文件上传下载、数据存取等服务。

### 参考链接

* [什么是微服务](https://time.geekbang.org/column/article/13882)
* [云原生](http://m.sohu.com/a/212826247_100078738)
* [Service Mesh：下一代微服务](https://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&mid=2650998746&idx=1&sn=5ef8234abc6855482db64b581e4e9a9a&chksm=bdbeff898ac9769f416cf3dff38fef3fc85adb007146b7cb4762bb4454aa4f199a4760586444&scene=27#wechat_redirect)
* [蚂蚁金服 Service Mesh 实践探索](https://mp.weixin.qq.com/s/543MsQkrtTdIfnfGd7LciA)
* [为什么说Service Mesh是云原生中流砥柱](https://time.geekbang.org/column/article/99169)
* [Service Mesh的本质、价值和应用探索](https://mp.weixin.qq.com/s/Q6kEgxdpcGdEEmQ44cFpQQ)
* [蚂蚁金服开源SOFAMesh](http://www.servicemesher.com/blog/introducing-sofamesh-a-solution-for-large-scale-service-mesh-by-ant-financial/)
* [蚂蚁金服 Service Mesh 渐进式迁移方案](https://www.cnblogs.com/Ant-Techfin/p/10087146.html)
* [蚂蚁金服是如何实现经典服务化架构往 Service Mesh 方向的演进的](https://www.sohu.com/a/235575064_99940985)
* [蚂蚁金服大规模微服务架构下的Service Mesh探索之路](https://yq.aliyun.com/articles/605235>)
* [Service Mesh是大方向，那Database Mesh呢？](<https://mp.weixin.qq.com/s?__biz=MzI4MTY5NTk4Ng==&mid=2247489125&idx=1&sn=c779ef1ee37747da599f880c94b840a9&chksm=eba415f8dcd39ceea1aee33ba2eeb03a7898b592c77e201a44f5ed7e73358c339156e5e146df&scene=27#wechat_redirect>)
* [DevOps](https://blog.csdn.net/zl1zl2zl3/article/details/84440685)
* [蚂蚁中间件开源](<https://segmentfault.com/a/1190000019038508>)

